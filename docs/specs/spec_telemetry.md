# Telemetry Export Format – Specification

## Purpose

Describe the format and semantics of the telemetry reports generated by the bootloader each generation. These files are used for debugging, research, and automated analysis by the `telemetry-review` skill.

## Inputs

- `App::exportHistory()` is called at the end of each evolution cycle (successful quine), writing a text file `gen_<n>.txt` under `build/<target>/bin/seq/<runid>/`.

## Behaviour

Each export file contains a series of labelled sections to aid humans and tools:

Exporters may also produce a JSON variant when the CLI option
`--telemetry-format=json` is specified; the JSON output mirrors the
labelled sections above in a simple key/value structure.  Parsers should
handle both formats transparently.

1. Header block showing the tool name and ISO timestamp of generation.
2. `Final Generation: <n>`
3. `Kernel Size: <bytes>`
4. (optional) `Mutations Attempted: <count>` and `Mutations Applied: <count>` with a `Mutation Breakdown: insert=<n>, delete=<n>, modify=<n>, append=<n>` line when mutation statistics are available.
5. (optional) `Traps: <code>` indicating the failure reason of the previous gen, if any.
6. (optional) `Gen Duration: <ms>` for timing measurements.
7. (optional) `Kernel Size Min/Max: <min>/<max>` for run‑wide extremes.
8. (optional) `Heuristic Blacklist Entries: <count>` summarising the current heuristic state.
9. (optional) `Advisor Entries: <count>` indicating how many telemetry entries the in‑memory advisor has loaded; useful when the model is involved in decision‑making.
10. (optional) `OPCODE SEQUENCE:` a newline‑terminated list of raw opcode bytes extracted from the kernel.  This is used by the neural network trainer when sequence‑based learning is enabled.
11. (optional) `INSTANCES: <n>` followed by one or more indented lines containing base64 blobs for each currently alive spawned kernel.  This is only present if the application has recorded instance activity during the run.

These are followed by the payload sections (absent in JSON
mode, which encodes the payloads directly as nested objects):

- `CURRENT KERNEL (BASE64):` with a base64‑encoded copy of the WASM binary (dash separators surround it).
- `HEX DUMP:` showing a formatted 16‑byte per line hex/ASCII view of the module.
- `DISASSEMBLY:` textual disassembly of each instruction along with offsets.
- `HISTORY LOG:` chronological list of generation events with timestamps and outcomes.

Exporting code now includes the disassembly and history log unconditionally; consumers should be prepared for these labels and ignore any additional future lines.  Parsers should remain robust to unknown labels and continue processing remaining data.

Telemetry consumers should ignore unknown labels and continue parsing
remaining fields.

## Constraints

- The Base64 payload must match the kernel byte size reported earlier in the file.
- Files should not exceed 64 KB to avoid tooling issues; if necessary compress automatically.

## Open Questions

- Should we export a JSON version for easier machine parsing?
- Is there value in including a snapshot of the App state (retry counts, uptime) directly in the report?

